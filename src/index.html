<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="joystick-viewer.css" />
  <link rel="stylesheet" href="template-editor.css" />
  <link rel="stylesheet" href="input-debugger.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Star Citizen Bindnig Utility</title>
  <script type="module" src="/button-renderer.js" defer></script>
  <script type="module" src="/main.js" defer></script>
  <script type="module" src="/joystick-viewer.js" defer></script>
  <script type="module" src="/template-editor.js" defer></script>
  <script type="module" src="/input-debugger.js" defer></script>
</head>

<body>
  <div class="app-container">
    <!-- Main App Header (Persistent) -->
    <header class="app-header">
      <!-- Header Row 1 -->
      <div class="header-row-1">
        <div class="header-logo">
          <h1>Star Citizen Binding Utility <span id="app-version">v0.5.1</span></h1>
          <div id="update-info" class="header-update-info"></div>
        </div>
        <div class="header-actions">
          <button id="sc-directory-btn" class="btn btn-primary" title="Configure Star Citizen installation directory">‚öôÔ∏è
            Auto Save Settings</button>
          <button id="load-btn" class="btn btn-primary">Load</button>
          <button id="save-as-btn" class="btn btn-primary" disabled>Save As...</button>
          <button id="save-btn" class="btn btn-success" disabled>üíæ Save Keybindings</button>
        </div>
        <div class="header-file-info">
          <div id="loaded-file-indicator" class="loaded-file-indicator" style="display: none;">
            <span class="file-icon">üìÑ</span>
            <span id="loaded-file-name">layout_NewBindings_exported.xml</span>
          </div>
        </div>
      </div>

      <!-- Header Row 2 -->
      <div class="header-row-2">
        <div class="header-tabs">
          <button id="tab-main" class="tab-btn active" data-tab="main">Keybindings</button>
          <button id="tab-visual" class="tab-btn" data-tab="visual">Visual View</button>
          <button id="tab-template" class="tab-btn" data-tab="template">Template Editor</button>
          <button id="tab-debugger" class="tab-btn" data-tab="debugger">Input Debugger</button>
          <button id="tab-help" class="tab-btn" data-tab="help">‚ùì Help</button>
        </div>
        <div class="header-template-info">
          <span>Template:</span>
          <span id="header-template-name">Untitled Template</span>
        </div>
      </div>
    </header>

    <!-- Main Content - Tab Container -->
    <div class="tab-content-container">
      <!-- TAB 1: Main Keybindings Page -->
      <div id="tab-content-main" class="tab-content active">
        <div class="main-content">
          <!-- Sidebar - Categories and Filters -->
          <aside class="sidebar">
            <div class="filter-section">
              <h3>Set Device IDs</h3>
              <button id="configure-joystick-mapping-btn" class="btn btn-secondary" style="width: 100%;">‚öôÔ∏è Set Joystick
                Mapping</button>
            </div>

            <div class=" filter-section">
              <h3>Filters</h3>
              <div class="category-list">
                <button class="category-item  category-item-indented active" data-filter="all">All</button>
                <button class="category-item  category-item-indented" data-filter="keyboard">Keyboard</button>
                <button class="category-item  category-item-indented" data-filter="mouse">Mouse</button>
                <button class="category-item  category-item-indented" data-filter="joystick">Joystick</button>
                <button class="category-item  category-item-indented" data-filter="gamepad">Gamepad</button>
                <div class="checkbox-container">
                  <input type="checkbox" id="customized-only-checkbox" />
                  <label for="customized-only-checkbox">Customized Only</label>
                </div>
              </div>
            </div>

            <div class="category-section">
              <h3>Categories</h3>
              <div id="category-list" class="category-list">
                <!-- Categories will be populated here -->
              </div>
            </div>

            <div class="device-info">
              <h3>Devices</h3>
              <div id="device-list">
                <!-- Device info will be populated here -->
              </div>
            </div>
          </aside>

          <!-- Main Panel - Keybindings Display -->
          <main class="bindings-panel">
            <div id="welcome-screen" class="welcome-screen">
              <div class="welcome-content">
                <h2>Welcome to Star Citizen Binding Utility</h2>
                <p>Load a Star Citizen keybinding file to view and manage your controls</p>
                <button id="welcome-load-btn" class="btn btn-large btn-primary">Load Keybindings File</button>
              </div>
            </div>

            <div id="bindings-content" class="bindings-content" style="display: none;">
              <div class="bindings-header">
                <h2 id="profile-name">Profile Name</h2>
                <input type="text" id="search-input" placeholder="Search actions..." class="search-input" />
              </div>

              <div id="action-maps-container" class="action-maps-container">
                <!-- Action maps and bindings will be populated here -->
              </div>
            </div>
          </main>
        </div>
      </div>

      <!-- TAB 2: Visual View Page -->
      <div id="tab-content-visual" class="tab-content">
        <div class="viewer-content">
          <!-- Joystick Display -->
          <div class="joystick-display">
            <!-- Quick Tips -->
            <div class="quick-tips" style="top:3rem;right:3rem;">Middle click to pan view<br>Scroll wheel to
              zoom<br>Click on button boxes to show all actions<br>Grey actions are default SC bind actions</div>

            <div id="welcome-screen-visual" class="welcome-screen">
              <div class="welcome-content">
                <h2>Select a joystick template to view your bindings</h2>
                <p>Make sure you have keybindings loaded first</p>
                <button id="welcome-select-btn" class="btn btn-large btn-primary">Select Template</button>
              </div>
            </div>

            <div id="viewer-canvas-container" class="canvas-container" style="display: none;">
              <canvas id="viewer-canvas"></canvas>
            </div>

            <!-- Floating Control Toolbar -->
            <div id="viewer-controls" class="viewer-controls" style="display: none;">
              <!-- Stick Selector -->
              <div class="control-group stick-selector" id="viewer-stick-selector" style="display: none;">
                <button id="viewer-left-stick-btn" class="control-btn" title="View Left Stick">
                  <span class="control-icon">üïπÔ∏è</span>
                  <span>Left</span>
                </button>
                <button id="viewer-right-stick-btn" class="control-btn active" title="View Right Stick">
                  <span class="control-icon">üïπÔ∏è</span>
                  <span>Right</span>
                </button>
              </div>

              <div class="control-divider"></div>

              <!-- Filter Controls -->
              <div class="control-group">
                <button id="hide-defaults-toggle" class="control-btn" title="Hide Default Bindings">
                  <span class="control-icon">üëÅÔ∏è</span>
                  <span>Show All</span>
                </button>
              </div>

              <div class="control-divider"></div>

              <!-- Template & Export -->
              <div class="control-group">
                <button id="select-template-btn" class="control-btn" title="Select Template">
                  <span class="control-icon">üìã</span>
                  <span>Open</span>
                </button>
                <button id="export-image-btn" class="control-btn" title="Export as Image">
                  <span class="control-icon">üíæ</span>
                  <span>Export</span>
                </button>
              </div>
            </div>

            <!-- Modifier Filter Toolbar -->
            <div id="modifier-toolbar" class="modifier-toolbar" style="display: none;">
              <span class="toolbar-label">Filter by:</span>
              <div class="modifier-options">
                <label class="modifier-radio">
                  <input type="radio" name="modifier-filter" value="all" checked />
                  <span>All</span>
                </label>
                <label class="modifier-radio">
                  <input type="radio" name="modifier-filter" value="lalt" />
                  <span>L Alt</span>
                </label>
                <label class="modifier-radio">
                  <input type="radio" name="modifier-filter" value="lctrl" />
                  <span>L Ctrl</span>
                </label>
                <label class="modifier-radio">
                  <input type="radio" name="modifier-filter" value="lshift" />
                  <span>L Shift</span>
                </label>
                <label class="modifier-radio">
                  <input type="radio" name="modifier-filter" value="rshift" />
                  <span>R Shift</span>
                </label>
                <label class="modifier-radio">
                  <input type="radio" name="modifier-filter" value="rctrl" />
                  <span>R Ctrl</span>
                </label>
                <label class="modifier-radio">
                  <input type="radio" name="modifier-filter" value="ralt" />
                  <span>R Alt</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 3: Template Editor Page -->
      <div id="tab-content-template" class="tab-content">
        <div class="editor-content">
          <!-- Left Sidebar - Controls -->
          <aside class="editor-sidebar">
            <div class="section">
              <h3>Template Info</h3>
              <label>
                Template Name:
                <input type="text" id="template-name" placeholder="e.g., T16000M Left" />
              </label>
              <label>
                Joystick Model:
                <input type="text" id="joystick-model" placeholder="e.g., Thrustmaster T16000M" />
              </label>
              <button id="configure-template-joysticks-btn" class="btn btn-secondary btn-block">‚öôÔ∏è Configure Joystick
                Mapping</button>
              <div id="stick-mapping-display" class="info-text" style="margin-top: 0.5rem;">
                <div><strong>Left Stick:</strong> <span id="left-stick-mapping">Not configured</span></div>
                <div><strong>Right Stick:</strong> <span id="right-stick-mapping">Not configured</span></div>
              </div>
            </div>

            <div class="section">
              <h3>Image</h3>
              <label>
                Image Mode:
                <select id="image-type-select">
                  <option value="single">Single Image (Both Sticks)</option>
                  <option value="dual">Separate Images (Left & Right)</option>
                </select>
              </label>
              <button id="load-image-btn" class="btn btn-secondary btn-block">Load Joystick Image</button>
              <div id="image-info" class="info-text"></div>
            </div>

            <div class="section">
              <h3>Image Mirror</h3>
              <label>
                Mirror Settings:
                <select id="image-flip-select">
                  <option value="none">No Mirror</option>
                  <option value="left">Mirror Left Stick</option>
                  <option value="right">Mirror Right Stick</option>
                </select>
              </label>
              <div class="info-text">
                If you have one image, select which stick to mirror. Select "No Mirror" if you have two
                different images.
              </div>
            </div>

            <div class="section">
              <h3>Button List</h3>
              <div class="button-list" id="button-list">
                <div class="empty-state-small">No buttons added yet</div>
              </div>
            </div>

            <div class="section">
              <h3>Instructions</h3>
              <div class="instructions">
                <p><strong>Adding a button:</strong></p>
                <ol>
                  <li>Click "+ Add" in the toolbar over the canvas</li>
                  <li>Click on the joystick image where the button is</li>
                  <li>Click where you want the label box to appear</li>
                  <li>Enter the button name/number</li>
                </ol>
                <p><strong>Editing:</strong></p>
                <ul>
                  <li>Click a button in the list to select it</li>
                  <li>Double-click a button to edit its name/ID</li>
                  <li>Use the üóëÔ∏è button in the toolbar to delete selected</li>
                  <li>Drag the handles on the canvas to reposition</li>
                </ul>
              </div>
            </div>

            <div class="section" style="display:flex; flex-direction:column; gap:6px;">
              <h3>Advanced</h3>
              <button id="clear-all-btn" class="btn btn-danger btn-block">Clear All Buttons</button>
              <button id="mirror-template-btn" class="btn btn-secondary btn-block">üîÑ Mirror Template</button>
              <button id="change-joystick-number-btn" class="btn btn-secondary btn-block">üî¢ Change All JS
                Numbers</button>
            </div>
          </aside>

          <!-- Main Panel - Canvas Editor -->
          <main class="editor-panel">
            <div class="canvas-container" id="canvas-container">
              <!-- Quick Tips -->
              <div class="quick-tips">Middle click to pan view<br>Scroll wheel to zoom<br>Press <kbd>F</kbd> to fit
                view<br>Double click buttons to
                edit<br>Left click + drag buttons to move
              </div>

              <!-- Floating Template Controls Panel -->
              <div class="template-controls-panel">
                <div class="control-group">
                  <div class="stick-selector">
                    <button id="left-stick-btn" class="control-btn">üïπÔ∏è Left</button>
                    <button id="right-stick-btn" class="control-btn active">üïπÔ∏è Right</button>
                  </div>
                </div>
                <div class="control-divider"></div>
                <div class="control-group">
                  <button id="new-template-btn" class="control-btn" title="Create new template">‚ú® New</button>
                  <button id="load-template-btn" class="control-btn" title="Load existing template">üìÇ Load</button>
                </div>
                <div class="control-divider"></div>
                <div class="control-group">
                  <button id="save-template-btn" class="control-btn btn-success" title="Save current template">üíæ
                    Save</button>
                  <button id="save-template-as-btn" class="control-btn btn-primary"
                    title="Save template with a new name">üíæ
                    Save As</button>
                </div>
              </div>
              <canvas id="editor-canvas"></canvas>
              <div id="canvas-overlay" class="canvas-overlay">
                <div class="welcome-message">
                  <h2>New Template</h2>
                  <p>1. Click the "Configure Joystick Mapping" button to configure joystick mappings</p>
                  <p>2. Use the "Load Joystick Image" button on the left</p>
                  <p>3. Adjust your image mirror settings if needed</p>
                </div>
              </div>
            </div>

            <div class="edit-controls">
              <button id="add-button-btn" class="btn btn-primary" title="Add Button">+ Add</button>
              <button id="delete-button-btn" class="btn btn-danger" disabled title="Delete Selected">üóëÔ∏è</button>
            </div>

            <div class="zoom-controls">
              <button id="zoom-out-btn" class="btn-icon">‚àí</button>
              <span id="zoom-level">100%</span>
              <button id="zoom-in-btn" class="btn-icon">+</button>
              <button id="zoom-fit-btn" class="btn btn-secondary btn-sm">Fit</button>
              <button id="zoom-reset-btn" class="btn btn-secondary btn-sm">100%</button>
            </div>
          </main>
        </div>
      </div>

      <!-- TAB 4: Input Debugger Page -->
      <div id="tab-content-debugger" class="tab-content">
        <div class="tab-subheader">
          <h2>Input Debugger</h2>
        </div>

        <div class="container">
          <main>
            <div class="debugger-controls">
              <button id="start-debug-btn" class="btn btn-primary">‚ñ∂ Start Detecting</button>
              <button id="stop-debug-btn" class="btn btn-secondary" disabled>‚è∏ Stop Detecting</button>
              <button id="clear-debug-btn" class="btn btn-secondary">üóëÔ∏è Clear Log</button>
              <button id="show-devices-btn" class="btn btn-secondary">üéÆ Show Devices</button>
              <span id="debug-status" class="status-indicator">Ready</span>
            </div>

            <div class="timeline-container">
              <div class="timeline-header">
                <h2>Input Timeline</h2>
                <div class="timeline-info">
                  <span id="event-count">0 events</span>
                  <label>
                    <input type="checkbox" id="auto-scroll-checkbox" checked>
                    Auto-scroll
                  </label>
                </div>
              </div>
              <div id="timeline" class="timeline">
                <div class="timeline-empty">
                  Press "Start Detecting" and then press any button or move any axis on your joystick...
                </div>
              </div>
            </div>

            <div class="stats-container">
              <h3>Statistics</h3>
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-label">Total Events</div>
                  <div class="stat-value" id="stat-total">0</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Unique Buttons</div>
                  <div class="stat-value" id="stat-buttons">0</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Unique Axes</div>
                  <div class="stat-value" id="stat-axes">0</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Hat Switches</div>
                  <div class="stat-value" id="stat-hats">0</div>
                </div>
              </div>
            </div>
          </main>
        </div>
      </div>

      <!-- TAB 5: Help Page -->
      <div id="tab-content-help" class="tab-content">
        <div class="tab-subheader">
          <h2>‚ùì Help & Tips</h2>
        </div>

        <div class="help-page-container">
          <div class="help-section">
            <h3>üéÆ Understanding JS1 and JS2</h3>
            <p>Star Citizen uses "js1", "js2", "js3", etc. to identify different joystick/gamepad devices. This
              numbering
              system is crucial for proper binding management.</p>
            <ul>
              <li><strong>js1</strong> = First joystick device</li>
              <li><strong>js2</strong> = Second joystick device</li>
              <li><strong>gp1</strong> = First gamepad device (Xbox controllers, etc.)</li>
            </ul>
            <p class="help-note"><strong>Important:</strong> Windows may enumerate devices differently each time you
              plug
              them in or restart your PC. This is why device mapping is critical!</p>
          </div>

          <div class="help-section">
            <h3>üìù Template Editor Tips</h3>
            <p>When creating a joystick template:</p>
            <ol>
              <li><strong>Configure Joystick Mapping First!</strong> Click the "Configure Joystick Mapping" button in
                the
                Template Info section before adding any buttons.</li>
              <li>This tells the template which physical device corresponds to the left stick and which is the right
                stick.</li>
              <li>Without this mapping, the template won't know which device you're configuring buttons for.</li>
              <li>You can test device detection by clicking "Test" next to each device to confirm you're pressing
                buttons
                on the correct stick.</li>
            </ol>
            <p class="help-note"><strong>Tip:</strong> If you have a dual stick setup (e.g., VKB Gladiator), typically
              the
              left stick is js1 and right stick is js2, but this can vary!</p>
          </div>

          <div class="help-section">
            <h3>üéØ Keybindings Page Tips</h3>
            <p>Before editing keybindings:</p>
            <ol>
              <li><strong>Set Joystick Mapping!</strong> Click "Configure Joystick Mapping" at the top of the page.</li>
              <li>This assigns device IDs (js1, js2, etc.) to your physical devices.</li>
              <li>When you press a button on a device, the app will know which js number to use based on this mapping.
              </li>
              <li>Use the "Test" button to confirm which physical device corresponds to each js number.</li>
              <li>Save the mapping - it persists between sessions so you don't have to reconfigure every time!</li>
            </ol>
            <p class="help-note"><strong>Why is this important?</strong> If you don't map devices first, bindings may be
              assigned to the wrong js number, causing controls to not work correctly in Star Citizen.</p>
          </div>

          <div class="help-section">
            <h3>üîÑ Common Workflows</h3>
            <h4>Creating a New Template:</h4>
            <ol>
              <li>Go to Template Editor tab</li>
              <li>Click "Configure Joystick Mapping"</li>
              <li>Assign your left and right sticks</li>
              <li>Load an image of your joystick</li>
              <li>Add buttons by clicking their positions</li>
              <li>Save your template</li>
            </ol>

            <h4>Editing Keybindings:</h4>
            <ol>
              <li>Click "Configure Joystick Mapping" (first time only)</li>
              <li>Load your keybindings XML file (or it auto-loads)</li>
              <li>Select a template in Visual View (optional but helpful)</li>
              <li>Find the action you want to bind</li>
              <li>Click "Detect Input" and press the button</li>
              <li>Save your changes</li>
            </ol>
          </div>

          <div class="help-section">
            <h3>‚ùì Troubleshooting</h3>
            <ul>
              <li><strong>Buttons not working in-game?</strong> Check your joystick mapping. The js numbers in your
                bindings file must match how Star Citizen sees your devices.</li>
              <li><strong>Wrong device responding?</strong> Reconfigure joystick mapping and make sure to test each
                device.</li>
              <li><strong>Lost your mapping?</strong> The app stores device mapping in localStorage, but you can always
                reconfigure it.</li>
              <li><strong>Template buttons look wrong?</strong> Use the mirror template feature or adjust image flip
                settings.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Binding Modal -->
  <div id="binding-modal" class="binding-modal" style="display: none;">
    <div class="binding-modal-content">
      <h2>Bind Input</h2>
      <div class="binding-modal-action" id="binding-modal-action">Action Name</div>
      <div class="binding-modal-status" id="binding-modal-status">Press any button on your joystick...</div>
      <div class="binding-modal-countdown" id="binding-modal-countdown">10</div>
      <div class="binding-modal-buttons">
        <button id="binding-cancel-btn" class="btn btn-secondary">Cancel</button>
        <button id="binding-reset-btn" class="btn btn-secondary">Reset to Default</button>
        <button id="binding-clear-btn" class="btn btn-secondary">Clear Binding</button>
      </div>
    </div>
  </div>

  <!-- Conflict Warning Modal -->
  <div id="conflict-modal" class="modal" style="display: none;">
    <div class="modal-content conflict-modal-content">
      <div class="modal-header">
        <h2>‚ö†Ô∏è Binding Conflict</h2>
      </div>
      <div class="modal-body">
        <p class="conflict-message">This button is already bound to the following actions:</p>
        <div id="conflict-list" class="conflict-list">
          <!-- Conflicts will be listed here -->
        </div>
        <p class="conflict-question">Do you want to keep this binding anyway?</p>
      </div>
      <div class="modal-footer">
        <button id="conflict-cancel-btn" class="btn btn-secondary">Cancel</button>
        <button id="conflict-confirm-btn" class="btn btn-primary">Keep Binding</button>
      </div>
    </div>
  </div>

  <!-- Hidden file input for loading -->
  <input type="file" id="file-input" accept=".xml" style="display: none;" />

  <!-- Joystick Mapping Modal -->
  <div id="joystick-mapping-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Configure Joystick Mapping</h2>
      </div>
      <div class="modal-body">
        <p class="mapping-help">Click "Detect" for each device type, then press any button on the physical device you
          want to use. The detected device will be automatically mapped.</p>

        <div class="stick-mapping-section">
          <div class="stick-section">
            <h3>Right Stick (js1)</h3>
            <div class="stick-info" id="js1-info">
              <div class="not-configured">Not configured</div>
            </div>
            <button id="detect-js1-btn" class="btn btn-primary">üéÆ Detect js1</button>
          </div>

          <div class="stick-section">
            <h3>Left Stick (js2)</h3>
            <div class="stick-info" id="js2-info">
              <div class="not-configured">Not configured</div>
            </div>
            <button id="detect-js2-btn" class="btn btn-primary">üéÆ Detect js2</button>
          </div>

          <div class="stick-section">
            <h3>Gamepad (gp1)</h3>
            <div class="stick-info" id="gp1-info">
              <div class="not-configured">Not configured</div>
            </div>
            <button id="detect-gp1-btn" class="btn btn-primary">üéÆ Detect gp1</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="joystick-mapping-save" class="btn btn-success">Save Mapping</button>
        <button id="joystick-mapping-cancel" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Device List Modal (for Input Debugger) -->
  <div id="device-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Connected Devices</h2>
        <button class="modal-close" id="close-modal-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div id="device-modal-list" class="device-list">
          <!-- Device cards will be populated here -->
        </div>
      </div>
      <div class="modal-footer">
        <button id="close-device-modal-footer" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Button Details Modal (for Template Editor) -->
  <div id="button-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h2>Button Details</h2>
      <label>
        Button Name:
        <input type="text" id="button-name-input" placeholder="e.g., Trigger or Hat 1" />
      </label>
      <label>
        Button Type:
        <select id="button-type-select">
          <option value="simple">Simple Button or Axis</option>
          <option value="hat4way">4-Way Hat Switch</option>
        </select>
      </label>

      <!-- Simple button input detection -->
      <div id="simple-input-section">
        <div class="hat-id-box" style="margin-bottom: 0.5rem;">
          <div class="hat-id-label">Button Number:</div>
          <div id="button-id-display" style="font-size: 1.1rem; font-weight: 500; color: var(--text-primary);">‚Äî</div>
          <div class="hat-id-label" style="margin-top: 0.5rem;">Button ID:</div>
          <code id="button-full-id-display"
            style="font-size: 0.9rem; color: #4ec9b0; background: var(--bg-dark); padding: 0.3rem 0.5rem; border-radius: 3px; display: inline-block;">‚Äî</code>
        </div>
        <div class="hat-button-group">
          <button id="button-modal-detect" class="btn btn-secondary">üéÆ Detect Input</button>
          <button id="button-modal-clear" class="btn btn-secondary">‚úï Clear</button>
        </div>
        <div id="input-detection-status" class="info-text"></div>
      </div>

      <!-- Hat switch input detection -->
      <div id="hat-input-section">
        <div class="hat-id-grid">
          <div class="hat-id-box">
            <div class="hat-id-label">‚¨ÜÔ∏è Up ID:</div>
            <div class="hat-id-display" data-direction="up">‚Äî</div>
          </div>
          <div class="hat-id-box">
            <div class="hat-id-label">‚¨áÔ∏è Down ID:</div>
            <div class="hat-id-display" data-direction="down">‚Äî</div>
          </div>
          <div class="hat-id-box">
            <div class="hat-id-label">‚¨ÖÔ∏è Left ID:</div>
            <div class="hat-id-display" data-direction="left">‚Äî</div>
          </div>
          <div class="hat-id-box">
            <div class="hat-id-label">‚û°Ô∏è Right ID:</div>
            <div class="hat-id-display" data-direction="right">‚Äî</div>
          </div>
        </div>
        <div class="hat-id-box" style="margin-bottom: 1rem;">
          <div class="hat-id-label">‚¨áÔ∏è Push ID:</div>
          <div class="hat-id-display" data-direction="push">‚Äî</div>
        </div>
        <div class="hat-button-container">
          <div class="hat-button-group">
            <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="up">‚¨ÜÔ∏è Detect Up</button>
            <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="up">‚úï Clear Up</button>
          </div>
          <div class="hat-button-group">
            <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="down">‚¨áÔ∏è Detect Down</button>
            <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="down">‚úï Clear Down</button>
          </div>
          <div class="hat-button-group">
            <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="left">‚¨ÖÔ∏è Detect Left</button>
            <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="left">‚úï Clear Left</button>
          </div>
          <div class="hat-button-group">
            <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="right">‚û°Ô∏è Detect Right</button>
            <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="right">‚úï Clear Right</button>
          </div>
          <div class="hat-button-group">
            <button class="btn btn-secondary btn-sm hat-detect-btn" data-direction="push">‚¨áÔ∏è Detect Push</button>
            <button class="btn btn-secondary btn-sm hat-clear-btn" data-direction="push">‚úï Clear Push</button>
          </div>
        </div>
        <div id="hat-detection-status" class="info-text">
        </div>
      </div>

      <div class="modal-buttons" style="margin-top: 1.5rem;">
        <button id="button-modal-delete" class="btn btn-danger" style="margin-right: auto;">Delete Button</button>
        <button id="button-modal-cancel" class="btn btn-secondary">Cancel</button>
        <button id="button-modal-save" class="btn btn-success">Save</button>
      </div>
    </div>
  </div>

  <!-- Template Selection Modal (for Visual View) -->
  <div id="template-modal" class="modal" style="display: none;">
    <div class="modal-content wide-modal">
      <h2>Select Joystick Template</h2>
      <div id="template-list" class="template-grid">
        <!-- Templates will be populated here -->
      </div>
      <div class="modal-buttons">
        <button id="template-modal-cancel" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Template Joystick Mapping Modal -->
  <div id="template-joystick-mapping-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Configure Joystick Mapping for Template</h2>
      </div>
      <div class="modal-body">
        <p class="mapping-help">Click "Detect" for each stick, then press any button on the physical joystick you want
          to use. The detected joystick will be automatically mapped.</p>

        <div class="stick-mapping-section">
          <div class="stick-section">
            <h3>Right Stick (js1)</h3>
            <div class="stick-info" id="right-stick-info">
              <div class="not-configured">Not configured</div>
            </div>
            <button id="detect-right-stick-btn" class="btn btn-primary">üéÆ Detect Right Stick</button>
          </div>

          <div class="stick-section">
            <h3>Left Stick (js2)</h3>
            <div class="stick-info" id="left-stick-info">
              <div class="not-configured">Not configured</div>
            </div>
            <button id="detect-left-stick-btn" class="btn btn-primary">üéÆ Detect Left Stick</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="template-joystick-mapping-save" class="btn btn-success">Save Mapping</button>
        <button id="template-joystick-mapping-cancel" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Custom Confirmation Modal -->
  <div id="confirmation-modal" class="modal" style="display: none;">
    <div class="modal-content confirmation-modal-content">
      <div class="modal-header">
        <h2 id="confirmation-title">Confirm Action</h2>
      </div>
      <div class="modal-body">
        <p id="confirmation-message">Are you sure you want to proceed?</p>
      </div>
      <div class="modal-footer">
        <button id="confirmation-cancel-btn" class="btn btn-secondary">Cancel</button>
        <button id="confirmation-confirm-btn" class="btn btn-primary">Confirm</button>
      </div>
    </div>
  </div>
  </div>
  </div>

  <!-- Help Modal -->
  <!-- Hidden file inputs -->
  <input type="file" id="image-file-input" accept="image/*" style="display: none;" />
  <input type="file" id="template-file-input" accept=".json" style="display: none;" />
  <input type="file" id="export-keybindings-input" style="display: none;" />

  <!-- Debug Info Footer -->
  <div id="debug-info"
    style="position: fixed; bottom: 0; right: 0; padding: 5px 10px; background: rgba(0,0,0,0.7); color: #888; font-size: 10px; border-top-left-radius: 4px; z-index: 10000;">
    <span id="debug-log-path" style="cursor: pointer; text-decoration: underline;"
      title="Click to copy log file path">Logs</span>
  </div>
  <img id="hidden-back" src="/src/icons/update_avail.png" hidden>
</body>

</html>